document.addEventListener("DOMContentLoaded",(function(){const menuToggle=document.querySelector(".menu-toggle");const navLinks=document.querySelector(".nav-links");if(menuToggle&&navLinks){menuToggle.addEventListener("click",(()=>{navLinks.classList.toggle("active")}))}const currentPage=window.location.pathname;document.querySelectorAll(".nav-link").forEach((link=>{if(link.getAttribute("href")===currentPage){link.classList.add("active")}}));document.querySelectorAll('a[href^="#"]').forEach((anchor=>{anchor.addEventListener("click",(function(e){e.preventDefault();const target=document.querySelector(this.getAttribute("href"));if(target){target.scrollIntoView({behavior:"smooth"})}}))}));const contactForm=document.getElementById("contact-form");if(contactForm){contactForm.addEventListener("submit",(async function(e){e.preventDefault();const formData={name:this.querySelector('[name="name"]').value,email:this.querySelector('[name="email"]').value,subject:this.querySelector('[name="subject"]').value,message:this.querySelector('[name="message"]').value};try{const response=await fetch("/api/contact",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(formData)});const result=await response.json();if(result.success){Swal.fire({title:translations[currentLanguage].messageSent,text:translations[currentLanguage].messageSuccess,icon:"success",confirmButtonText:"OK"});contactForm.reset()}else{throw new Error(result.message)}}catch(error){Swal.fire({title:translations[currentLanguage].error,text:translations[currentLanguage].messageError,icon:"error",confirmButtonText:"OK"})}}))}}));document.addEventListener("DOMContentLoaded",(function(){const contactForm=document.getElementById("contact-form");if(contactForm){contactForm.addEventListener("submit",(async function(e){e.preventDefault();const formData={name:document.getElementById("name").value,email:document.getElementById("email").value,phone:document.getElementById("phone")?.value||"",message:document.getElementById("message").value};try{const response=await fetch("http://localhost:8000/api/send-contact.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(formData)});const result=await response.json();if(result.success){Swal.fire({title:"Message envoyé !",text:"Votre message a été envoyé avec succès. Nous vous répondrons dans les plus brefs délais.",icon:"success",confirmButtonText:"OK",confirmButtonColor:"#3ea0c6"});contactForm.reset()}else{throw new Error(result.message||"Une erreur est survenue")}}catch(error){console.error("Contact error:",error);Swal.fire({title:"Erreur",text:"Une erreur est survenue lors de l'envoi de votre message. Veuillez réessayer plus tard.",icon:"error",confirmButtonText:"OK",confirmButtonColor:"#3ea0c6"})}}))}}));const destinations=[{name:"Paris",description:"La ville de l'amour et de la lumière",image:"/assets/images/destinations/paris.jpeg",price:"850 000 FCFA"},{name:"Dubai",description:"La perle du Moyen-Orient",image:"/assets/images/destinations/dubai.jpg",price:"1 250 000 FCFA"},{name:"Istanbul",description:"Le carrefour des civilisations",image:"/assets/images/destinations/istanbul.jpg",price:"950 000 FCFA"}];let currentDestinationIndex=0;function updateDestinationDisplay(){const destination=destinations[currentDestinationIndex];const destinationDisplay=document.getElementById("destination-display");destinationDisplay.innerHTML=`\n        <div class="destination-card">\n            <img src="${destination.image}" alt="${destination.name}" class="destination-image">\n            <div class="destination-info">\n                <h2>${destination.name}</h2>\n                <p>${destination.description}</p>\n                <p class="price">${destination.price}</p>\n                <button onclick="redirectToReservation('${destination.name}')" class="btn-primary">Réserver maintenant</button>\n            </div>\n        </div>\n    `}function nextDestination(){currentDestinationIndex=(currentDestinationIndex+1)%destinations.length;updateDestinationDisplay()}function previousDestination(){currentDestinationIndex=(currentDestinationIndex-1+destinations.length)%destinations.length;updateDestinationDisplay()}function redirectToReservation(destination){window.location.href=`/reservations.html?destination=${encodeURIComponent(destination)}`}document.addEventListener("DOMContentLoaded",(()=>{updateDestinationDisplay()}));function switchLanguage(lang){localStorage.setItem("selectedLanguage",lang);document.querySelectorAll(".language-switcher button").forEach((button=>{button.classList.remove("active");if(button.querySelector(`img[alt="${lang}"]`)){button.classList.add("active")}}));updateContent(lang)}function updateContent(lang){document.querySelectorAll("[data-i18n]").forEach((element=>{const key=element.getAttribute("data-i18n");if(translations[lang]&&translations[lang][key]){element.textContent=translations[lang][key]}}));document.querySelectorAll("[data-i18n-placeholder]").forEach((element=>{const key=element.getAttribute("data-i18n-placeholder");if(translations[lang]&&translations[lang][key]){element.placeholder=translations[lang][key]}}));document.querySelectorAll("[data-i18n-title]").forEach((element=>{const key=element.getAttribute("data-i18n-title");if(translations[lang]&&translations[lang][key]){element.title=translations[lang][key]}}))}function toggleLanguageMenu(){const menu=document.getElementById("languageMenu");menu.style.display=menu.style.display==="block"?"none":"block"}function changeLanguage(lang){localStorage.setItem("preferredLanguage",lang);const currentFlag=document.getElementById("currentFlag");const currentLang=document.getElementById("currentLang");if(lang==="fr"){currentFlag.src="assets/images/icons/iconefr.jpeg";currentFlag.alt="Français";currentLang.textContent="FR"}else{currentFlag.src="assets/images/icons/iconeeng.jpeg";currentFlag.alt="English";currentLang.textContent="EN"}updateContent(lang);const menu=document.getElementById("languageMenu");menu.style.display="none"}function updateContent(lang){document.querySelectorAll("[data-i18n]").forEach((element=>{const key=element.getAttribute("data-i18n");if(translations[lang]&&translations[lang][key]){element.textContent=translations[lang][key]}}));document.querySelectorAll("[data-i18n-placeholder]").forEach((element=>{const key=element.getAttribute("data-i18n-placeholder");if(translations[lang]&&translations[lang][key]){element.placeholder=translations[lang][key]}}))}document.addEventListener("DOMContentLoaded",(()=>{const preferredLanguage=localStorage.getItem("preferredLanguage")||"fr";changeLanguage(preferredLanguage);document.addEventListener("click",(e=>{const languageMenu=document.getElementById("languageMenu");const languageBtn=document.querySelector(".language-btn");if(!languageBtn.contains(e.target)&&!languageMenu.contains(e.target)){languageMenu.style.display="none"}}));if(!document.querySelector(".language-switcher")){const nav=document.querySelector(".nav-links");if(nav){const languageSwitcher=document.createElement("div");languageSwitcher.className="language-switcher";languageSwitcher.innerHTML=`\n                <button class="language-btn" onclick="toggleLanguageMenu()">\n                    <img src="/assets/images/icons/iconefr.jpeg" alt="French Flag" id="currentFlag">\n                    <span id="currentLang">FR</span>\n                </button>\n                <div class="language-menu" id="languageMenu">\n                    <div class="language-option" onclick="changeLanguage('fr')">\n                        <img src="/assets/images/icons/iconefr.jpeg" alt="French Flag">\n                        <span>FR</span>\n                    </div>\n                    <div class="language-option" onclick="changeLanguage('en')">\n                        <img src="/assets/images/icons/iconeeng.jpeg" alt="English Flag">\n                        <span>EN</span>\n                    </div>\n                </div>\n            `;nav.appendChild(languageSwitcher)}}}));document.addEventListener("DOMContentLoaded",(function(){const currentPath=window.location.pathname;const navLinks=document.querySelectorAll(".nav-menu a");navLinks.forEach((link=>{if(link.getAttribute("href")===currentPath){link.classList.add("active")}}));document.querySelectorAll('a[href^="#"]').forEach((anchor=>{anchor.addEventListener("click",(function(e){e.preventDefault();const target=document.querySelector(this.getAttribute("href"));if(target){target.scrollIntoView({behavior:"smooth"})}}))}));function toggleMenu(){const hamburger=document.querySelector(".hamburger");const navMenu=document.querySelector(".nav-menu");hamburger.classList.toggle("active");navMenu.classList.toggle("active")}document.querySelectorAll(".nav-menu a").forEach((link=>{link.addEventListener("click",(()=>{const hamburger=document.querySelector(".hamburger");const navMenu=document.querySelector(".nav-menu");hamburger.classList.remove("active");navMenu.classList.remove("active")}))}))}));let map;let currentPopup=null;function initMap(){map=L.map("map",{center:[20,0],zoom:2,zoomControl:false,minZoom:2});L.control.zoom({position:"topright"}).addTo(map);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:" OpenStreetMap contributors",maxZoom:19}).addTo(map);const destinations=[{name:"Paris",coords:[48.8566,2.3522],description:"La ville lumière vous attend avec ses monuments emblématiques, sa gastronomie raffinée et son art de vivre unique.",image:"/assets/images/destinations/paris.jpg"},{name:"Tokyo",coords:[35.6762,139.6503],description:"Découvrez le parfait mélange entre tradition et modernité dans cette métropole fascinante du Japon.",image:"/assets/images/destinations/tokyo.jpg"},{name:"New York",coords:[40.7128,-74.006],description:"La ville qui ne dort jamais vous invite à explorer ses gratte-ciels, sa culture vibrante et son énergie incomparable.",image:"/assets/images/destinations/newyork.jpg"},{name:"Dubai",coords:[25.2048,55.2708],description:"Entre désert et modernité, Dubai vous offre une expérience unique au cœur du Moyen-Orient.",image:"/assets/images/destinations/dubai.jpg"},{name:"Bangkok",coords:[13.7563,100.5018],description:"Immergez-vous dans la culture thaïlandaise, ses temples majestueux et sa cuisine savoureuse.",image:"/assets/images/destinations/bangkok.jpg"},{name:"Sydney",coords:[-33.8688,151.2093],description:"Entre plages paradisiaques et architecture moderne, Sydney vous promet des moments inoubliables.",image:"/assets/images/destinations/sydney.jpg"},{name:"Rio de Janeiro",coords:[-22.9068,-43.1729],description:"Laissez-vous séduire par les plages de Copacabana, le Corcovado et l'ambiance festive de Rio.",image:"/assets/images/destinations/rio.jpg"},{name:"Le Caire",coords:[30.0444,31.2357],description:"Explorez les mystères de l'Égypte ancienne et moderne dans cette ville millénaire.",image:"/assets/images/destinations/lecaire.jpg"}];const customIcon=L.divIcon({className:"custom-marker",html:'<div class="marker-pin"></div>',iconSize:[30,30],iconAnchor:[15,30],popupAnchor:[0,-30]});function createPopupContent(dest){const currentLang=localStorage.getItem("selectedLanguage")||"fr";const bookNowText=currentLang==="fr"?"Réserver":"Book Now";return`\n            <div class="destination-popup">\n                <div class="popup-image">\n                    <img src="${dest.image}" alt="${dest.name}" onerror="this.src='/assets/images/destinations/default.jpg'">\n                </div>\n                <div class="popup-content">\n                    <h2>${dest.name}</h2>\n                    <p>${dest.description}</p>\n                    <button onclick="window.location.href='/reservations.html?destination=${encodeURIComponent(dest.name)}'" class="popup-button">\n                        ${bookNowText}\n                    </button>\n                </div>\n            </div>\n        `}destinations.forEach((dest=>{const marker=L.marker(dest.coords,{icon:customIcon}).addTo(map);const popup=L.popup({maxWidth:400,className:"custom-popup",closeButton:true,closeOnClick:false}).setContent((()=>createPopupContent(dest)));marker.on("click",(function(e){if(currentPopup){map.closePopup(currentPopup)}popup.setLatLng(e.target.getLatLng());popup.openOn(map);currentPopup=popup;map.flyTo(dest.coords,5,{duration:1})}))}));document.addEventListener("languageChanged",(function(){if(currentPopup&&currentPopup.isOpen()){const dest=destinations.find((d=>{const popupLatLng=currentPopup.getLatLng();return d.coords[0]===popupLatLng.lat&&d.coords[1]===popupLatLng.lng}));if(dest){currentPopup.setContent(createPopupContent(dest))}}}))}if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",initMap)}else{initMap()}document.addEventListener("DOMContentLoaded",(function(){function openOfferPopup(offerTitle){const today=(new Date).toISOString().split("T")[0];Swal.fire({title:"Réserver cette offre",html:`\n                <form id="offer-form" class="swal2-form">\n                    <div class="form-group">\n                        <input type="text" id="name" class="swal2-input" placeholder="Votre nom" required>\n                    </div>\n                    <div class="form-group">\n                        <input type="email" id="email" class="swal2-input" placeholder="Votre email" required>\n                    </div>\n                    <div class="form-group">\n                        <input type="tel" id="phone" class="swal2-input" placeholder="Votre téléphone" required>\n                    </div>\n                    <div class="form-group">\n                        <input type="date" id="departureDate" class="swal2-input" min="${today}" required>\n                    </div>\n                    <div class="form-group">\n                        <input type="number" id="passengers" class="swal2-input" placeholder="Nombre de passagers" min="1" required>\n                    </div>\n                    <div class="form-group">\n                        <textarea id="message" class="swal2-textarea" placeholder="Message (optionnel)"></textarea>\n                    </div>\n                </form>\n            `,showCancelButton:true,confirmButtonText:"Envoyer",cancelButtonText:"Annuler",confirmButtonColor:"#3ea0c6",cancelButtonColor:"#d33",showLoaderOnConfirm:true,preConfirm:()=>{const formData={offerTitle:offerTitle,name:document.getElementById("name").value,email:document.getElementById("email").value,phone:document.getElementById("phone").value,departureDate:document.getElementById("departureDate").value,passengers:document.getElementById("passengers").value,message:document.getElementById("message").value};return fetch("http://localhost:8000/api/send-offer.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(formData)}).then((response=>response.json())).then((result=>{if(!result.success){throw new Error(result.message||"Une erreur est survenue")}return result}))}}).then((result=>{if(result.value){Swal.fire({title:"Demande envoyée !",text:"Nous avons bien reçu votre demande et vous contacterons très prochainement.",icon:"success",confirmButtonColor:"#3ea0c6"})}})).catch((error=>{Swal.fire({title:"Erreur",text:error.message||"Une erreur est survenue lors de l'envoi de votre demande.",icon:"error",confirmButtonColor:"#3ea0c6"})}))}document.querySelectorAll(".reserve-offer-btn").forEach((button=>{button.addEventListener("click",(function(e){e.preventDefault();const offerTitle=this.getAttribute("data-offer-title");openOfferPopup(offerTitle)}))}));const style=document.createElement("style");style.textContent=`\n        .swal2-form {\n            margin: 1em auto;\n        }\n        .swal2-form .form-group {\n            margin-bottom: 1em;\n        }\n        .swal2-input, .swal2-textarea {\n            width: 100% !important;\n            margin: 0.5em auto !important;\n        }\n        .swal2-textarea {\n            height: 100px !important;\n        }\n    `;document.head.appendChild(style)}));function getUrlParameter(name){const urlParams=new URLSearchParams(window.location.search);return urlParams.get(name)}function fillDestinationForm(){const destination=getUrlParameter("destination");if(destination){const input=document.getElementById("destination");if(input){input.value=decodeURIComponent(destination);input.dispatchEvent(new Event("change"))}}}if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",fillDestinationForm)}else{fillDestinationForm()}document.addEventListener("DOMContentLoaded",(function(){const today=(new Date).toISOString().split("T")[0];document.getElementById("departure-date").min=today;document.getElementById("return-date").min=today;const form=document.getElementById("booking-form");function updateTravelersFields(){const adults=parseInt(document.getElementById("adults").value)||0;const children=parseInt(document.getElementById("children").value)||0;const infants=parseInt(document.getElementById("infants").value)||0;const totalTravelers=adults+children+infants;const container=document.getElementById("travelers-container");const detailsSection=document.getElementById("travelers-details");container.innerHTML="";if(totalTravelers>1){detailsSection.style.display="block";for(let i=2;i<=totalTravelers;i++){const travelerType=i<=adults?"adult":i<=adults+children?"child":"infant";const card=document.createElement("div");card.className="traveler-card";const typeLabel=travelerType==="adult"?"Adulte":travelerType==="child"?"Enfant":"Bébé";card.innerHTML=`\n                    <h4>${typeLabel} ${i}</h4>\n                    <div class="traveler-inputs">\n                        <div class="form-group">\n                            <label for="traveler-${i}-firstname">Prénom</label>\n                            <input type="text" id="traveler-${i}-firstname" name="traveler-${i}-firstname" required>\n                        </div>\n                        <div class="form-group">\n                            <label for="traveler-${i}-lastname">Nom</label>\n                            <input type="text" id="traveler-${i}-lastname" name="traveler-${i}-lastname" required>\n                        </div>\n                    </div>\n                `;container.appendChild(card)}}else{detailsSection.style.display="none"}}document.getElementById("adults").addEventListener("change",updateTravelersFields);document.getElementById("children").addEventListener("change",updateTravelersFields);document.getElementById("infants").addEventListener("change",updateTravelersFields);if(form){form.addEventListener("submit",(async function(e){e.preventDefault();const departureDate=new Date(document.getElementById("departure-date").value);const returnDate=new Date(document.getElementById("return-date").value);const today=new Date;today.setHours(0,0,0,0);if(departureDate<today){Swal.fire({title:"Erreur",text:"La date de départ ne peut pas être dans le passé",icon:"error",confirmButtonColor:"#3ea0c6"});return}if(returnDate<=departureDate){Swal.fire({title:"Erreur",text:"La date de retour doit être après la date de départ",icon:"error",confirmButtonColor:"#3ea0c6"});return}const formData={name:document.getElementById("name").value,email:document.getElementById("email").value,phone:document.getElementById("phone").value,departure:document.getElementById("departure").value,destination:document.getElementById("destination").value,departureDate:document.getElementById("departure-date").value,returnDate:document.getElementById("return-date").value,adults:document.getElementById("adults").value,children:document.getElementById("children").value,infants:document.getElementById("infants").value,cabin:document.getElementById("cabin").value,airline:document.getElementById("airline").value||"",message:document.getElementById("message")?.value||"",additionalTravelers:[]};const totalTravelers=parseInt(formData.adults)+parseInt(formData.children)+parseInt(formData.infants);for(let i=2;i<=totalTravelers;i++){const firstname=document.getElementById(`traveler-${i}-firstname`)?.value;const lastname=document.getElementById(`traveler-${i}-lastname`)?.value;const type=i<=parseInt(formData.adults)?"adult":i<=parseInt(formData.adults)+parseInt(formData.children)?"child":"infant";if(firstname&&lastname){formData.additionalTravelers.push({firstname:firstname,lastname:lastname,type:type})}}try{const response=await fetch("/api/public/book-flight",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(formData)});const result=await response.json();if(result.success){Swal.fire({title:"Réservation envoyée !",text:"Votre demande de réservation a été envoyée avec succès. Nous vous contacterons dans les plus brefs délais.",icon:"success",confirmButtonColor:"#3ea0c6"});form.reset()}else{throw new Error(result.message||"Une erreur est survenue")}}catch(error){console.error("Booking error:",error);Swal.fire({title:"Erreur",text:"Une erreur est survenue lors de l'envoi de votre réservation. Veuillez réessayer plus tard.",icon:"error",confirmButtonColor:"#3ea0c6"})}}))}}));const translations={fr:{home:"Accueil",destinations:"Destinations",reservations:"Réservations",offers:"Offres",contact:"Contact",heroTitle:"Voyagez avec Kiks Travel",heroDesc:"Découvrez le monde avec notre expertise et vivez des expériences uniques et inoubliables",bookNow:"Réserver maintenant",offersTitle:"Nos Offres Spéciales",offersDesc:"Découvrez nos meilleures offres et promotions pour des voyages inoubliables.",contactUs:"Contactez-nous",contactDesc:"Notre équipe est à votre disposition pour répondre à toutes vos questions",openingHours:"Horaires d'ouverture",openingHoursDetails:"Bureau : Du lundi au vendredi : 9h - 18h",phoneAvailability:"Service téléphonique disponible 7j/7",formFullName:"Nom et Prénom",formFullNamePlaceholder:"Entrez votre nom et prénom",formEmail:"Email",formPhone:"Téléphone",formMessage:"Message (optionnel)",formSubmit:"Envoyer",formAdults:"Adultes (12+ ans)",formChildren:"Enfants (2-11 ans)",formInfants:"Bébés (0-2 ans)",formCabin:"Cabine",formAirline:"Compagnie aérienne souhaitée (optionnel)",formAirlinePlaceholder:"Ex: Air France, Turkish Airlines...",formOrigin:"Origine",formTravelersDetails:"Détails des voyageurs",address:"Adresse",phone:"Tél",followUs:"Suivez-nous",contactTitle:"Contact"},en:{home:"Home",destinations:"Destinations",reservations:"Bookings",offers:"Offers",contact:"Contact",heroTitle:"Travel with Kiks Travel",heroDesc:"Discover the world with our expertise and live unique, unforgettable experiences",bookNow:"Book Now",offersTitle:"Our Special Offers",offersDesc:"Discover our best offers and promotions for unforgettable trips.",contactUs:"Contact Us",contactDesc:"Our team is at your disposal to answer all your questions",openingHours:"Opening Hours",openingHoursDetails:"Office: Monday to Friday: 9am - 6pm",phoneAvailability:"Phone service available 7 days a week",formFullName:"First and Last Name",formFullNamePlaceholder:"Enter your first and last name",formEmail:"Email",formPhone:"Phone",formMessage:"Message (optional)",formSubmit:"Send",formAdults:"Adults (12+ years)",formChildren:"Children (2-11 years)",formInfants:"Infants (0-2 years)",formCabin:"Cabin",formAirline:"Desired Airline (optional)",formAirlinePlaceholder:"Ex: Air France, Turkish Airlines...",formOrigin:"Origin",formTravelersDetails:"Travelers Details",address:"Address",phone:"Phone",followUs:"Follow Us",contactTitle:"Contact"}};